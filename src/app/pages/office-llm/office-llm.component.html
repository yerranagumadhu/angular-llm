<div class="layout">
    <!-- Sidebar -->
    <div class="sidebar-wrapper" [class.collapsed]="isSidebarCollapsed">
        <div class="sidebar">
            <!-- New Session Button -->
            <button class="new-session-btn" (click)="startNewSession()" title="New Session">
                <span class="new-icon">‚ûï</span>
                <span class="new-label" *ngIf="!isSidebarCollapsed">New Session</span>
            </button>

            <!-- Expanded Header -->
            <div class="sidebar-header" *ngIf="!isSidebarCollapsed" (click)="toggleSidebar()" title="Toggle Sidebar">
                <span class="toggle-icon">‚Üê</span>
                <span class="sidebar-title">üïí Past Sessions</span>
            </div>

            <!-- Collapsed Title -->
            <div class="vertical-title" *ngIf="isSidebarCollapsed" (click)="toggleSidebar()" title="Expand Sidebar">
                üïí Past Sessions
            </div>

            <!-- Session Groups -->
            <div *ngIf="!isSidebarCollapsed" class="date-groups">
                <ng-container *ngFor="let groupName of groupOrder">
                    <div *ngIf="groupedItems[groupName]?.length" class="date-group">
                        <h4>{{ groupName }}</h4>
                        <ul>
                            <li *ngFor="let item of getVisibleItems(groupedItems[groupName], groupName)"
                                (click)="onSessionClick(item)">
                                <span class="item-icon">üìÑ</span>
                                <span class="item-title">{{ item.title }}</span>
                            </li>
                        </ul>
                        <button *ngIf="groupedItems[groupName].length > 5" class="toggle-btn"
                            (click)="toggleGroup(groupName)">
                            {{ isGroupExpanded(groupName) ? 'Show Less' : 'Show More' }}
                        </button>
                    </div>
                </ng-container>
            </div>
        </div>
    </div>
    <!-- ‚îÄ‚îÄ INSERT CONTROL PANEL HERE ‚îÄ‚îÄ -->
    <div class="control-card" [class.collapsed]="isControlCollapsed">
        <!-- Header always shows the toggle (and horizontal title when expanded) -->
        <div class="control-card__header">
            <button class="control-card__toggle" (click)="toggleControl()">
                <i class="dx-icon" [ngClass]="{
                'dx-icon-chevrondoubleleft': !isControlCollapsed,
                'dx-icon-chevronright': isControlCollapsed
                }"></i>
            </button>
            <h3 *ngIf="!isControlCollapsed" class="control-card__title">
                üìù Content &amp; Prompts
            </h3>
        </div>

        <!-- Vertical title spans entire card when collapsed -->
        <div *ngIf="isControlCollapsed" class="control-card__vertical-title" (click)="toggleControl()">
            üìù Content &amp; Prompts
        </div>


        <!-- only show when expanded -->
        <div class="control-panel" *ngIf="!isControlCollapsed">
            <!-- group 1 -->
            <div class="control-group">
                <h4>Content Configuration</h4>
                <dx-select-box [dataSource]="audiences" displayExpr="text" valueExpr="id" placeholder="Select Audience"
                    [(value)]="selectedAudience">
                </dx-select-box>
                <dx-select-box [dataSource]="docTypes" displayExpr="text" valueExpr="id"
                    placeholder="Select Document Type" [(value)]="selectedDocType">
                </dx-select-box>
            </div>
            <div class="control-group">
                <h4>Upload Document</h4>
                <dx-file-uploader [uploadMode]="'instantly'" selectButtonText="Choose File..."
                    labelText="No file selected" (onUploaded)="onFileUploaded($event)">
                </dx-file-uploader>
            </div>
            <div class="control-group">
                <h4>Prompt Library</h4>

                <!-- Prompt selector -->
                <dx-select-box [dataSource]="prompts" displayExpr="name" valueExpr="id" placeholder="Choose a Prompt"
                    [(value)]="selectedPrompt" (onValueChanged)="onPromptChange($event.value)">
                </dx-select-box>

                <!-- Only show textarea & actions when there‚Äôs promptText -->
                <div *ngIf="promptText" class="prompt-textarea-wrapper">
                    <dx-text-area [(value)]="promptText" height="200" placeholder="Edit or expand your prompt here">
                    </dx-text-area>

                    <div class="prompt-actions">
                        <!-- COPY -->
                        <button class="action-btn copy-btn" [class.filled]="isCopied" title="Copy to clipboard"
                            (click)="copyPrompt()">
                            <i class="dx-icon dx-icon-copy"></i>
                        </button>

                        <!-- FAVORITE -->
                        <button class="action-btn fav-btn" [class.filled]="isCurrentPromptFavorite()"
                            title="Save to library" (click)="onFavoriteClick()">
                            <i class="dx-icon dx-icon-add"></i>
                        </button>
                        <!-- only show when we‚Äôre renaming/saving -->
                        <div *ngIf="showFavoriteNaming" class="favorite-naming">
                            <dx-text-box [(value)]="favoriteName" placeholder="Enter favorite name‚Ä¶">
                            </dx-text-box>
                            <button class="action-btn" title="Confirm" (click)="confirmFavoriteName()">
                                <i class="dx-icon dx-icon-check"></i>
                            </button>
                            <button class="action-btn" title="Cancel" (click)="cancelFavoriteNaming()">
                                <i class="dx-icon dx-icon-close"></i>
                            </button>
                        </div>

                    </div>
                </div>
            </div>


        </div>
    </div>
    <!-- ‚îÄ‚îÄ END INSERT ‚îÄ‚îÄ -->


    <!-- Chat Panel -->
    <div class="chat-panel">
        <div class="chat-title" *ngIf="selectedItemTitle">
            <h2>{{ selectedItemTitle }}</h2> <!-- Display the selected chat title -->
        </div>
        <dx-chat [items]="messages" [user]="currentUser" (onMessageEntered)="onMessageEntered($event)">
        </dx-chat>
    </div>
</div>